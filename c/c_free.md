# 在Linux下C编程关于内存管理的相关文档

## C编程如何进行内存管理

	内存的申请操作函数主要包括：```malloc(),calloc(), realloc()```等相关函数，使用这些函数申请的内存空间需要程序员手动进行释放操作，而释放函数为```free()```函数。

在编程中使用free()函数遇见的问题主要为：

1. 在但线程的情况下，使用函数申请内存空间后再使用free()函数释放申请的内存空间时，虽然调用了free()函数，但是通过top或者free命令查看该进程申请的内存空间仍未被释放回系统。关于这一点主要是和平台性相关：
- Windows平台调用free，内存会立马降下来，即立马就归还给了操作系统
- Linux平台调用free，内存不会释放回OS，而是释放回系统的内存缓冲池，进程退出时才会释放回OS
- IOS平台调用free后，也只是释放回系统的内存缓冲池，进程退出才释放会OS
针对这种情况可以调用malloc_trim()函数，将进程堆空间的最上层可用内存释放回OS，如： malloc_trim(0)
2. 在多线程(pthreads)的情况下，在非主线程中申请的内存空间使用free()后就将内存空间立马释放会操作系统了，且发现**在某些情况下只要使用了多线程，即使是在主线程申请的内存空间使用free()函数后也是立马释放回OS**。此情况还需要进行深入研究。**经过测试发现，在某些情况下即使使用了多线程，free()之后也必须调用malloc_trim(0)方法才能释放内存给os，即为了保险起见，在free()之后，按需求调用malloc_trim()方法。**
